<!DOCTYPE html>
<html>
  <head>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://use.fontawesome.com/c6078e9ff6.js"></script>
    <link rel="stylesheet" href="./styles.css"> 
    <link rel="shortcut icon" type="image/png" href="./twitter-32.png"/>
    <link rel="icon" type="image/png" href="./favicon.png"/>
    <title>My Tweet Manager</title>
  </head>
<body style="margin: 0;background: #585858;font-family: sans-serif;">
  <div id="tweetcount" style="padding: 5px 8px 0px;position: fixed;padding-bottom: 5px;display: none;top: 67px;z-index: 8;right: 20px;background: white;border: 3px double rgb(144, 144, 144);border-radius: 4px;color: gray;line-height: 23px;text-align: center;transition: color 0.8s ease 0s;">
    All Tweets
    </div>
<i class="fa fa-bars menubutton" onclick="javascript: openmenu()"></i>
<div id="menu" style="Z-INDEX: 1;">
  <ul>
    <li onclick="javascript: clickmenu('all', 'All Tweets')">All Tweets</li>
    <li onclick="javascript: clickmenu('toview', 'To View')">To View</li>
    <li onclick="javascript: clickmenu('toread', 'To read')">To read</li>
    <li onclick="javascript: clickmenu('tokeep', 'To keep')">To keep</li>
    <li onclick="javascript: clickmenu('imp', 'Important')">Important</li>
  </ul>
</div>
<script>
    var text = "";
    var origin = "";
    var nextid = "";
    var currentIndex = 0;
    var currpage = 0;
    var dosearchmore = true;
    var url = "";

    $( document ).ready(function() {
      var paramid = getParameterByName('tweetid');
      if (paramid)
        getInformationbyid(paramid);

      window.onscroll = function(ev) {
      if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight && dosearchmore) {
        dosearchmore = false;
        if ($('#moretweets').css('display') == 'inline-block') {
            $("#moretweets").click();
        }
        setTimeout(function(){ 
          dosearchmore = true;
        }, 2000);

      }
    };

      $(window).scroll(function (event) {
      var scroll = $(window).scrollTop();
      if (scroll > 200) {
        $('#gotop').fadeIn(700); 
      }
      else {
        $('#gotop').fadeOut(700);
      }
    });
      $('#filtertext, #filterdate1, #filterdate2, #filterid, #filterauthor, #filtertag').keypress(function(event){
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if(keycode == '13' && $(this).val().length > 0){
          getInformation(false);
        }
      });    

      $("#tweet").on("paste", function() {
          setTimeout(function(){
            nextid = parseInt($('#maxid').val()) + 1;
            $('#tweetid').val(nextid);
            
            text = $('#tweet').val();
            text = "\"" + text.replace(/"/g, '').replace('<\/script>', '<&#47;script>') + "\"";
            
            origin = text.substring(text.indexOf('&mdash;') + 8, text.lastIndexOf(' <a href=https')); 

            url = text.substring(text.lastIndexOf('https://twitter'), text.lastIndexOf('?ref_src=')); 
            alert(url);

            var date = text.substring(text.lastIndexOf('ref_src=twsrc%5Etfw>') + 20, text.lastIndexOf('</a></blockquote>')); 
            $('#datecap').text(date);

            $('#date').val(date.substring(date.length - 4));

            $('#date').focus(function(){
              var that = this;
              setTimeout(function(){ that.selectionStart = that.selectionEnd = 10000; }, 0);
            });
            
            $('#postedby').text(origin);

            $('#date').focus();
          }, 700);

      });


      $( "#moretweets" ).bind( "click", function( event ) {
        getInformation(true);
      });
      $( "#btnsearch" ).bind( "click", function( event ) {
        getInformation(false);
      });
      $( "#btnreset" ).bind( "click", function( event ) {
        resetFields();
      });
      console.log(77777);    
    });
   
      var getInformation = function(ismoretweets) 
    {
        $('#mask').fadeIn(300);  
        var path = "./data.json";
        var endIndex = currentIndex + Number($('#recordspersearch').val());
        var objToFocus = -1;
        var ind = 0;
        

        var dofiltertext = $('#filtertext').val().length > 0; 
        var dofilterdate1 = $('#filterdate1').val().length > 0; 
        var dofilterdate2 = $('#filterdate2').val().length > 0; 
        var dofilterid = $('#filterid').val().length > 0; 
        var dofiltertag = $('#filtertag').val().length > 0; 
        var dofilterauthor = $('#filterauthor').val().length > 0;
        var dofiltercat = $('#selectedcat').val().length > 0 && $('#selectedcat').val() != 'all';  

        $('#moretweets').hide();
        if (!ismoretweets) {
          currentIndex = 0;
          endIndex = currentIndex + 5;

          $("#main").empty();
        }

        currpage = currpage + 1;

        $.getJSON(path, function(data) 
        {
          $.each(data.Tweets, function(key, val) 
            {
              var newtweet = null;
              var dofiltertextfinal = false;
              var dofilterdate1final = false;
              var dofilterdate2final = false;
              var dofilteridfinal = false;
              var dofiltertagfinal = false;
              var dofiltercatfinal = false;
              var dofilterauthorfinal = false;

              dofiltertextfinal = !dofiltertext || (dofiltertext && val.tweet.toLowerCase().includes($('#filtertext').val().toLowerCase()));
              dofilterdate1final = !dofilterdate1 || (dofilterdate1 && val.date >= Number($('#filterdate1').val()));
              dofilterdate2final = !dofilterdate2 || (dofilterdate2 && val.date <= Number($('#filterdate2').val()));
              dofilteridfinal = !dofilterid || (dofilterid && (Number(val.id) == Number($('#filterid').val())));
              dofiltertagfinal = !dofiltertag || (dofiltertag && val.tags.includes($('#filtertag').val()));
              dofiltercatfinal = !dofiltercat || (dofiltercat && val.categories.includes($('#selectedcat').val()));
              dofilterauthorfinal = !dofilterauthor || (dofilterauthor && val.author.toLowerCase().includes($('#filterauthor').val().toLowerCase()));

              if (dofiltertextfinal && dofilterdate1final && dofiltertagfinal && dofilterdate2final && dofilteridfinal
                && dofilterauthorfinal && dofiltercatfinal) {
                  ind = ind + 1;
              }
            });
            
            var toindex = 0;
            if (currentIndex + Number($('#recordspersearch').val()) < ind)
            toindex = currentIndex + Number($('#recordspersearch').val());
            else 
            toindex = ind;
            if (Number($('#recordspersearch').val()) < ind) {
              
              $('#tweetcount').css('background', '#fff900');
              $('#tweetcount').html((currentIndex + 1)  + " to " + toindex + " of " + ind + "<br>In " + $('#selectedcattext').val());    
              var aux = ind;

              setTimeout(function(){ 
                if (aux == toindex) { 
                  $('#tweetcount').html(aux + " Tweets<br>In " + $('#selectedcattext').val());  
                }
                else {
                  $('#tweetcount').html(toindex + " of " + aux + "<br>In " + $('#selectedcattext').val());  
                }   
                
                $('#tweetcount').css('background', 'white');
              }, 3000);

            }
            else {
              $('#tweetcount').html(ind + " Tweets<br>In " + $('#selectedcattext').val());  
            }


            ind = 0;
            $.each(data.Tweets, function(key, val) 
            {
              var newtweet = null;
              var dofiltertextfinal = false;
              var dofilterdate1final = false;
              var dofilterdate2final = false;
              var dofilteridfinal = false;
              var dofiltertagfinal = false;
              var dofiltercatfinal = false;
              var dofilterauthorfinal = false;

              if (currentIndex < endIndex && ((ismoretweets && currentIndex == ind) || !ismoretweets)) {
                dofiltertextfinal = !dofiltertext || (dofiltertext && val.tweet.toLowerCase().includes($('#filtertext').val().toLowerCase()));
                dofilterdate1final = !dofilterdate1 || (dofilterdate1 && val.date >= Number($('#filterdate1').val()));
                dofilterdate2final = !dofilterdate2 || (dofilterdate2 && val.date <= Number($('#filterdate2').val()));
                dofilteridfinal = !dofilterid || (dofilterid && (Number(val.id) == Number($('#filterid').val())));
                dofiltertagfinal = !dofiltertag || (dofiltertag && val.tags.includes($('#filtertag').val()));
                dofiltercatfinal = !dofiltercat || (dofiltercat && val.categories.includes($('#selectedcat').val()));

                dofilterauthorfinal = !dofilterauthor || (dofilterauthor && val.author.toLowerCase().includes($('#filterauthor').val().toLowerCase()));

                if (dofiltertextfinal && dofilterdate1final && dofiltertagfinal && dofilterdate2final && dofilteridfinal
                  && dofilterauthorfinal && dofiltercatfinal) {

                  $('#moretweets').hide();
                  var newtweet = $('#main').append($('<div id="inid" class="tweet"></div>'));
                  var newtweetobj = $('#inid');
                  newtweetobj.append($('<i onclick="javascript: expandCat(this)" id="expand" class="fa fa-angle-double-down"></i><div class="categorias"><b>Id </b>' + val.id + '<b> Categories </b>' + val.categories + '</div>'));
                  newtweetobj.append($('<div class="tags"><i onclick="javascript: internallinkcopy(\'' + val.id + '\')" id="internallink" class="fa fa-link"></i><i onclick="javascript: externallinkcopy(\'' + val.url + '\')" id="externallink" class="fa fa-external-link"></i><b>Tags </b>' + val.tags + '</div>'));
                  newtweetobj.append($('<div class="innertweet"></div>'));
                  newtweetobj.find('.innertweet').append(val.tweet);
                  newtweetobj.attr('id', val.id);

                  if (objToFocus < 0) {
 
                    $('#tweetcount').fadeIn(800);

                    objToFocus = currentIndex;
                    var newtweetobjaction = newtweetobj;
                    $('html, body').animate({
                      scrollTop: $(newtweetobjaction).offset().top
                    }, 700);

                  }
                  currentIndex = currentIndex + 1;
                }   
              }
              else {
                if (currentIndex >= endIndex) {
                  $('#moretweets').show();
                  
                  setTimeout(function(){
                    $('#mask').fadeOut(300);
                  }, 300);

                  return false;
                }
              }
              
              setTimeout(function(){
                  $('#mask').fadeOut(300);
                }, 300);

                ind = ind + 1;
            });
        }); 
    }
    



    var getInformationbyid = function(id) 
    {
        $('#mask').fadeIn(300);  
        var path = "./data.json";
        var objToFocus = -1;
        

        $.getJSON(path, function(data) 
        {
          $.each(data.Tweets, function(key, val) 
            {
              if (val.id.includes(id)) {
                $('#moretweets').hide();
                  var newtweet = $('#main').append($('<div id="inid" class="tweet"></div>'));
                  var newtweetobj = $('#inid');
                  newtweetobj.append($('<i onclick="javascript: expandCat(this)" id="expand" class="fa fa-angle-double-down"></i><div class="categorias"><b>Id </b>' + val.id + '<b> Categories </b>' + val.categories + '</div>'));
                  newtweetobj.append($('<div class="tags"><i onclick="javascript: internallinkcopy(\'' + val.id + '\')" id="internallink" class="fa fa-link"></i><i onclick="javascript: externallinkcopy(\'' + val.url + '\')" id="externallink" class="fa fa-external-link"></i><b>Tags </b>' + val.tags + '</div>'));
                  newtweetobj.append($('<div class="innertweet"></div>'));
                  newtweetobj.find('.innertweet').append(val.tweet);
                  newtweetobj.attr('id', val.id);

                    var newtweetobjaction = newtweetobj;
                    $('html, body').animate({
                      scrollTop: $(newtweetobjaction).offset().top
                    }, 700);

                    return false;
              }
              
              setTimeout(function(){
                  $('#mask').fadeOut(300);
                }, 300);
            });
        }); 
    }




    function getParameterByName(name) {
        var url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
    
    function expandCat(obj) {
      var jobj = $(obj).parent().find('.categorias');
      if (jobj.is(":visible"))
        jobj.hide();
      else
        jobj.show();
    }
    function openmenu() {
      if ($('#menu').css('width') == '0px') {
        $('#menu').css('width', '180px');
      }
      else {
        $('#menu').css('width', '0px');
      }

    }
    function gotop() {
      $(window).scrollTop( 0 );
    }   

    function internallinkcopy(id) {
      console.log('-------id-----');
      console.log(id);
      $('#linkresult').val("https://sleepy-mclean-3aea2d.netlify.com/?tweetid=" + id);
      $("#linkresult").select();
      document.execCommand('copy');
      console.log($('#linkresult').val());
      
    }

    function externallinkcopy(link) {
      console.log('-------link-----');
      console.log(link);
      $('#linkresult').val(link);
      $("#linkresult").select();
      document.execCommand('copy');
      console.log($('#linkresult').val());
    }
    </script>

<i id="sear" onclick="javascript: togglecriterions()" class="fa fa-search"></i>
<span class="label text top">Text</span>
<input type="text" class="top" style="margin-right: 10px;" id="filtertext"></input>
<span class="label tag top">Tag</span>
<input type="text" class="top" style="width: 100px; margin-right: 10px;" id="filtertag"></input>
<span class="label author top">Author</span>
<input type="text" class="top" style="width: 100px;margin-right: 10px;" id="filterauthor"></input>
<span class="label date top">Date</span>
<input type="text" class="top" id="filterdate1" style="width: 60px;"></input>
<input type="text" class="top" id="filterdate2" style="width: 60px;margin-right: 10px;"></input>
<span class="label id top">Id</span>
<input type="text" class="top" style="width: 30px;" id="filterid"></input>
<button id="btnsearch" class="top" style="position: relative;top: -7px;margin-left: 38px;">Search<i class="fa fa-search"></i></button>
<button id="btnreset" class="top" style="position: relative;top: -7px;margin-left: 10px;">Reset<i class="fa fa-eraser"></i></button>
<span class="toptitle" style="color: white;font-size: 30px;position: relative;margin-left: calc(50% - 255px);">My Tweet Manager</span>
<i id="addtweet" class="fa fa-plus-square"></i>

<input type="hidden" id="maxid" value="0">
<input type="hidden" id="selectedcat" value="all">
<input type="hidden" id="selectedcattext" value="All Tweets">
<input type="hidden" id="recordspersearch" value="5">
<div style="position: fixed;width: 100%;height: calc(100% - 55px);background: #00000099;top: 55px;z-index: -1;">
  <i class="fa fa-twitter"></i>
  <div style="position: fixed;z-index: -1;width: 100%;text-align: center;bottom: 3px;color: white;font-size: 12px;">
    &copy; Copyright 2019, Rasarrad Corporation  
</div>
</div>
<div id="main" style="margin-bottom: 20px;background: gray;color: white;border-top: 1px solid white;margin-top: 2px;">
    
</div>
<button style="cursor: pointer;margin-left: calc(50% - 50px);margin-top: 0px;margin-bottom: 68px;height: 38px;padding-left: 13px;padding-right: 13px;font-weight: bold;color: #313131;border-radius: 5px;display: none;" id="moretweets">More Tweets</button>
<div class="addpopup" style="display: block;display: none;">
  <i id="closepopup" class="fa fa-remove"></i>
    <span style="margin-left: auto;margin-right: auto;width: 100%;display: block;text-align: center;font-size: 20px; height: 32px; padding-top: 3px;">Add new</span>
    Tweet <input id="tweet" style="width: 45px;" type="text"></input>
    Date <div style="display: inline;" id="datecap"></div> <input id="date" style="width: 61px;" type="text"></input>
    Id <input style="display: inline; width: 28px;" id="tweetid" type="text"></input> Posted by <div style="display: inline;" id="postedby"></div>
    <br><br>
    Categories <input style="width: 704px;" id="categories" type="text"></input><br><br>
    Tags <input style="width: 748px;" id="tags" type="text"></input><br><br>
    <span style="margin-left: auto;margin-right: auto;width: 100%;display: block;font-size: 20px;height: 32px;padding-top: 3px;text-align: left;position: relative;top: 7px;">Result</span>
    <div style="float: right;position: absolute;right: 154px;top: 150px;height: 19px;width: 112px;color: #ffffff;">Add one more</div><input type="checkbox" style="float: right;position: absolute;right: 90px; top: 148px; height: 19px; width: 112px;color: #484848;" id="onemore" checked>
    <button style="cursor: pointer;float: right;position: absolute;right: 10px;top: 146px;height: 28px;width: 112px;font-size: 16px;color: #484848;" id="create">Create</button>
    <textarea style="width: 784px;height: 297px;" id="result" type="text"></textarea>
</div>
<i onmouseover="javascript: gotop()" id="gotop" class="fa fa-angle-double-up"></i>
<div id="mask" style="position: fixed;width: 100%; height: 100%;background: #00000099; top: 0;display: none;"><i class="fa fa-circle-o-notch fa-spin"></i></div>
<textarea style="width: 200px;height: 100px;position: fixed;" id="linkresult" type="text"></textarea>
</body>

<script>
 
 $( document ).ready(function() {
    $( "#create" ).bind( "click", function( event ) {
         $('#result').val("{\r\n\"id\": \"" + nextid + "\",\r\n\"url\": \"" + url  + "\",\r\n\"date\": \"" + $('#date').val() + "\",\r\n\"author\": \"" + origin  + "\",\r\n\"categories\": \"" + $('#categories').val() + "\",\r\n\"tags\": \"" + $('#tags').val() + "\",\r\n\"tweet\": " + text + "\r\n},");

         $('#maxid').val(nextid);
         $("#result").select();
        document.execCommand('copy');

          $('#tweet').val('');
          $('#date').val('');
          $('#datecap').text('');
          $('#tweetid').val('');
          $('#postedby').text('');
          $('#categories').val('');
          $('#tags').val('');
        if ($("#onemore").is(":checked")) {

          $('#tweet').focus();
        } 
        else {
          $('#result').val('');
          $('.addpopup').fadeOut(2000);
        }       
    });


    $( "#addtweet" ).bind( "click", function( event ) {
      openCreatePopup();
    });

    $( "#closepopup" ).bind( "click", function( event ) {
      closePopup();
    });
  });

 
  function resetFields() 
    {
      $("#main").empty();
      $('#moretweets').hide();
      $('#selectedcat').val('all');
      $('#selectedcattext').val('All Tweets');
      $('#tweetcount').hide();  
      $('#tweet').val('');
          $('#date').val('');
          $('#datecap').text('');
          $('#tweetid').val('');
          $('#postedby').text('');
          $('#categories').val('');
          $('#tags').val('');
          $('#result').val('');  
      $('.addpopup').fadeOut();

    }  

  var clickmenu = function(val, text) 
    {      
      resetFields();

      $('#selectedcat').val(val);
      $('#selectedcattext').val(text);


      openmenu();
      getInformation(false);

    }  


  var closePopup = function() 
    {
      $('#tweet').val('');
          $('#date').val('');
          $('#datecap').text('');
          $('#tweetid').val('');
          $('#postedby').text('');
          $('#categories').val('');
          $('#tags').val('');
          $('#result').val('');  
      $('.addpopup').fadeOut();

    }  
  
 
    var openCreatePopup = function() 
    {
      $('#tweet').val('');
          $('#date').val('');
          $('#datecap').text('');
          $('#tweetid').val('');
          $('#postedby').text('');
          $('#categories').val('');
          $('#tags').val('');
      $('.addpopup').fadeIn();
      $('#tweet').focus();
      $('#result').val('');  
    }  
 
    var togglecriterions = function() 
    {
      if ($('.toptitle').css('display') == 'none') {
        $('.toptitle').css('display', 'inline');
        $('html').find('.top').each( function( index, element ){
            $(this).css('display', 'none');
        });
      }
      else {
        $('.toptitle').css('display', 'none');
        $('html').find('.top').each( function( index, element ){
          $(this).css('display', 'inline');
        });
      } 
    }     
    
    </script>
</html>
