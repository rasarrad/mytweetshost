<!DOCTYPE html>
<html>
  <head>
    <script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
  </head>
<body>

<h1>My tweet manager</h1>
<button id="aaa">Add tweet</button>

<script>
    var text = "";
    var origin = "";
    var nextid = "";

    $( document ).ready(function() {
      getInformation();

      $("#tweet").on("paste", function() {
          setTimeout(function(){
            nextid = parseInt($('#maxid').val()) + 1;
            $('#tweetid').val(nextid);
            
            text = $('#tweet').val();
            text = "\"" + text.replace(/"/g, '').replace('<\/script>', '<&#47;script>') + "\"";
            
            origin = text.substring(text.indexOf('&mdash;') + 8, text.lastIndexOf(' <a href=https')); 

            var date = text.substring(text.lastIndexOf('ref_src=twsrc%5Etfw>') + 20, text.lastIndexOf('</a></blockquote>')); 
            $('#datecap').text(date);

            $('#date').val(date.substring(date.length - 4));

            $('#date').focus(function(){
              var that = this;
              setTimeout(function(){ that.selectionStart = that.selectionEnd = 10000; }, 0);
            });
            
            $('#postedby').text(origin);

            $('#date').focus();
          }, 700);

      });

      $( "#create" ).bind( "click", function( event ) {
           $('#result').val("{\r\n\"id\": \"" + nextid + "\",\r\n\"date\": \"" + $('#date').val() + "\",\r\n\"author\": \"" + origin  + "\",\r\n\"categories\": \"" + $('#categories').val() + "\",\r\n\"tags\": \"" + $('#tags').val() + "\",\r\n\"tweet\": " + text + "\r\n},");

           $('#maxid').val(nextid);
           $("#result").select();
          document.execCommand('copy');

          if ($("#onemore").is(":checked")) {
            $('#tweet').val('');
            $('#date').val('');
            $('#datecap').text('');
            $('#tweetid').val('');
            $('#postedby').text('');
            $('#categories').val('');
            $('#tags').val('');
            $('#result').val('');

            $('#tweet').focus();
          } 
          else {
            $('.addpopup').fadeOut(2000);
          }       
      });



      $( "#aaa" ).bind( "click", function( event ) {
        openCreatePopup();
        //var foo = getParameterByName('foo');
        //alert(55);
        //getInformation();
        //$('.tweet#t10').css('display', 'block');
        //getInformation();
        //$( "#t1102" ).append("<blockquote class=twitter-tweet><p lang=en dir=ltr><a href=https://twitter.com/hashtag/ConcoursdElegance2019?src=hash&amp;ref_src=twsrc%5Etfw>#ConcoursdElegance2019</a> closes in style at <a href=https://twitter.com/hashtag/PebbleBeach?src=hash&amp;ref_src=twsrc%5Etfw>#PebbleBeach</a><a href=https://twitter.com/hashtag/USA?src=hash&amp;ref_src=twsrc%5Etfw>#USA</a> <a href=https://twitter.com/hashtag/Monterey?src=hash&amp;ref_src=twsrc%5Etfw>#Monterey</a> <a href=https://t.co/aLyxSFRBmv>pic.twitter.com/aLyxSFRBmv</a></p>&mdash; Ruptly (@Ruptly) <a href=https://twitter.com/Ruptly/status/1163365281995137024?ref_src=twsrc%5Etfw>August 19, 2019</a></blockquote> <script async src=https://platform.twitter.com/widgets.js charset=utf-8><&#47;script>");
      });

      console.log(555);
    });
    var openCreatePopup = function() 
    {
      $('.addpopup').fadeIn();
      $('#tweet').focus();
        
    }     
      var getInformation = function() 
    {
        var path = "./data.json";
        var informationArray= [];
        $.getJSON(path, function(data) 
        {
            $.each(data.Tweets, function(key, val) 
            {
              var newtweet = $('#main').append($('<div id="' + val.id + '" class="tweet"></div>'));
              var newtweetobj = $('#' + val.id);
              newtweetobj.append($('<div class="categorias">' + val.categories + '</div>'));
              newtweetobj.append($('<div class="tags">' + val.tags + '</div>'));
              newtweetobj.append($('<div class="innertweet"></div>'));
              newtweetobj.find('.tweet').append(val.tweet);
          
            });
        }); 
        return informationArray; 
    }
    
    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, '\\$&');
        var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }
    
    </script>
    
    <style>
        .tweet {
          max-width: 520px;
        margin-left: auto;
        margin-right: auto;

        }
        
        .EmbeddedTweet-tweet {
          background: #80808061;
        border: 1px solid gray;
        border-radius: 0px;
        }
         .addpopup {
            max-width: 800px;
    margin-left: auto;
    margin-right: auto;
    border: 1px solid gray;
    position: fixed;
    top: 100px;
    width: 800px;
    height: 500px;
    background: gray;
    color: white;
    left: calc(50% - 400px);
    padding-left: 10px;
         }
        </style>


<input type="text"></input>
<p></p>
<input type="hidden" id="maxid" value="6">
<div id="main">
    
</div>

<div class="addpopup" style="display: block;display: none;">
    <span style="margin-left: auto;margin-right: auto;width: 100%;display: block;text-align: center;font-size: 20px; height: 32px; padding-top: 3px;">Add new</span>
    Tweet: <input id="tweet" style="width: 135px;" type="text"></input>
    Date: <div style="display: inline;" id="datecap"></div> <input id="date" style="width: 95px;" type="text"></input>
    Id: <input style="display: inline; width: 35px;" id="tweetid" type="text"></input> Posted by: <div style="display: inline;" id="postedby"></div>
    <br><br>
    Categories: <input style="width: 710px;" id="categories" type="text"></input><br><br>
    Tags: <input style="width: 748px;" id="tags" type="text"></input><br><br>
    <span style="margin-left: auto;margin-right: auto;width: 100%;display: block;text-align: center;font-size: 20px; height: 32px; padding-top: 3px;">Result</span>
    <div style="float: right;position: absolute;right: 148px;top: 150px;height: 19px;width: 112px;color: #ffffff;">Add one more:</div><input type="checkbox" style="float: right;position: absolute;right: 90px; top: 148px; height: 19px; width: 112px;color: #484848;" id="onemore" checked>
    <button style="float: right;position: absolute;right: 10px;top: 146px;height: 28px;width: 112px;font-size: 16px;color: #484848;" id="create">Create</button>
    <textarea style="width: 784px;height: 297px;" id="result" type="text"></textarea>
</div>

<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

</body>
</html>
